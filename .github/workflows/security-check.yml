name: ğŸ›¡ï¸ Security & Anomaly Check

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  scan:
    runs-on: ubuntu-latest

    steps:
    - name: â¬‡ï¸ Checkout repo
      uses: actions/checkout@v3

    - name: ğŸ” Run Gitleaks
      uses: gitleaks/gitleaks-action@v2
      with:
        config-path: .gitleaks.toml  # or .gitleaks.yml
      env:
        GITLEAKS_LICENSE: ${{ secrets.GITLEAKS_LICENSE }}

    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    - name: ğŸ“¦ Install Python dependencies
      run: |
        pip install pandas scikit-learn

    - name: ğŸš€ Run Anomaly Detection
      run: python detect.py

    - name: ğŸ“„ Upload anomaly report
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: anomaly-report
        path: anomaly_report.md

    - name: âŒ Fail if anomaly_report.md exists
      if: always()
      run: |
        if [ -f anomaly_report.md ]; then
          echo "Anomalies detected â€” Failing build"
          exit 1
        fi
